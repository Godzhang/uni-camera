import{_ as a,c as t,s,a as o,b as e,d as c,g as i,p as l,o as n,e as r,w as h,i as d,f as u,h as f,j as m,k as p,r as g,F as C,l as k,m as _,n as y,q as I,t as b,u as v,S as P}from"./index-6614c13b.js";const w=a({data:()=>({cameraPosition:"back",flashMode:"off",capturedImage:"",photoList:[],cameraContext:null}),computed:{flashIcon(){return"on"===this.flashMode?"/static/flash-on.svg":"/static/flash-off.svg"}},onLoad(){this.initCamera(),this.loadPhotoHistory()},onShow(){this.loadPhotoHistory()},methods:{initCamera(){this.cameraContext=t()},onCameraInit(a){},onCameraError(a){s({title:"相机启动失败，请检查权限设置",icon:"none",duration:3e3})},onScanCode(a){},takePhoto(){this.cameraContext||this.initCamera(),this.cameraContext.takePhoto({quality:"high",success:a=>{this.capturedImage=a.tempImagePath},fail:a=>{s({title:"拍照失败，请重试",icon:"none"})}})},switchCamera(){this.cameraPosition="back"===this.cameraPosition?"front":"back"},toggleFlash(){this.flashMode="off"===this.flashMode?"on":"off"},retakePhoto(){this.capturedImage=""},savePhoto(){this.capturedImage&&o({filePath:this.capturedImage,success:()=>{s({title:"保存成功",icon:"success"}),this.addToHistory(this.capturedImage),this.capturedImage=""},fail:a=>{a.errMsg.includes("auth")?e({title:"权限不足",content:"请在设置中开启保存到相册的权限",showCancel:!1}):s({title:"保存失败",icon:"none"})}})},addToHistory(a){this.photoList.unshift(a),this.photoList.length>10&&(this.photoList=this.photoList.slice(0,10)),c("photoHistory",this.photoList)},loadPhotoHistory(){try{const a=i("photoHistory");a&&Array.isArray(a)&&(this.photoList=a)}catch(a){}},previewPhoto(a){l({urls:[a],current:a})}}},[["render",function(a,t,s,o,e,c){const i=k,l=d,w=_,L=y,x=I,H=b,S=v,F=P;return n(),r(l,{class:"container"},{default:h(()=>[u(l,{class:"header"},{default:h(()=>[u(i,{class:"title"},{default:h(()=>[f("相机拍照")]),_:1})]),_:1}),m(" 相机组件 "),e.capturedImage?m("v-if",!0):(n(),r(l,{key:0,class:"camera-container"},{default:h(()=>[u(x,{class:"camera","device-position":"back",flash:"off",onError:c.onCameraError,onInitdone:c.onCameraInit,onScancode:c.onScanCode},{default:h(()=>[u(L,{class:"camera-overlay"},{default:h(()=>[u(L,{class:"camera-controls"},{default:h(()=>[u(L,{class:"btn-group"},{default:h(()=>[u(L,{class:"camera-btn switch-btn",onClick:c.switchCamera},{default:h(()=>[u(w,{src:"./static/switch-camera.svg",class:"btn-icon"})]),_:1},8,["onClick"]),u(L,{class:"camera-btn capture-btn",onClick:c.takePhoto},{default:h(()=>[u(L,{class:"capture-inner"})]),_:1},8,["onClick"]),u(L,{class:"camera-btn flash-btn",onClick:c.toggleFlash},{default:h(()=>[u(w,{src:c.flashIcon,class:"btn-icon"},null,8,["src"])]),_:1},8,["onClick"])]),_:1})]),_:1})]),_:1})]),_:1},8,["onError","onInitdone","onScancode"])]),_:1})),m(" 图片预览 "),e.capturedImage?(n(),r(l,{key:1,class:"preview-container"},{default:h(()=>[u(H,{src:e.capturedImage,class:"preview-image",mode:"aspectFit"},null,8,["src"]),u(l,{class:"preview-controls"},{default:h(()=>[u(S,{class:"btn btn-secondary",onClick:c.retakePhoto},{default:h(()=>[f("重新拍照")]),_:1},8,["onClick"]),u(S,{class:"btn btn-success",onClick:c.savePhoto},{default:h(()=>[f("保存照片")]),_:1},8,["onClick"])]),_:1})]),_:1})):m("v-if",!0),m(" 拍照历史 "),e.photoList.length>0&&!e.capturedImage?(n(),r(l,{key:2,class:"photo-history"},{default:h(()=>[u(l,{class:"history-title"},{default:h(()=>[f("拍照历史")]),_:1}),u(F,{class:"history-scroll","scroll-x":"true"},{default:h(()=>[(n(!0),p(C,null,g(e.photoList,(a,t)=>(n(),r(l,{class:"history-item",key:t,onClick:t=>c.previewPhoto(a)},{default:h(()=>[u(H,{src:a,class:"history-image",mode:"aspectFill"},null,8,["src"])]),_:2},1032,["onClick"]))),128))]),_:1})]),_:1})):m("v-if",!0),m(" 提示信息 "),e.capturedImage?m("v-if",!0):(n(),r(l,{key:3,class:"tips"},{default:h(()=>[u(i,{class:"tips-text"},{default:h(()=>[f("点击下方圆形按钮进行拍照")]),_:1})]),_:1}))]),_:1})}],["__scopeId","data-v-07caa254"]]);export{w as default};
