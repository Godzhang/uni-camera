import{_ as t,u as e,s as a,o as s,e as i,w as o,i as n,j as d,f as r,h as c,v as h,x as l,t as m,q as u,l as w,y as g}from"./index-6bf6b323.js";const v=t({data:()=>({videoSrc:"",capturedImage:"",isVideoReady:!1,cameraPosition:"back",statusMessage:"正在启动相机...",canvasWidth:640,canvasHeight:480,mediaStream:null,videoContext:null,updateText:""}),onReady(){this.videoContext=e("myVideo"),this.initCamera()},unmounted(){this.stopCamera()},methods:{async initCamera(){try{this.statusMessage="正在启动相机...",await this.startCamera()}catch(t){this.statusMessage="相机启动失败，请检查权限设置"}},async startCamera(){try{this.mediaStream&&this.mediaStream.getTracks().forEach(t=>t.stop());const t=window.devicePixelRatio||1,e={video:{facingMode:"environment",width:window.screen.width*t,height:window.screen.height*t*.83},aspectRatio:{ideal:window.screen.width*t/(window.screen.height*t*.83)},audio:!1};window.ww=window.screen.width*t,window.wh=window.screen.height*t*.83,this.updateText="验证添加aspectRatio是否生效",this.mediaStream=await navigator.mediaDevices.getUserMedia(e),this.$nextTick(()=>{const t=document.querySelector("video");t.style.objectFit="cover",window.vi=t,"srcObject"in t?t.srcObject=this.mediaStream:t.src=window.URL.createObjectURL(this.mediaStream),t.onloadedmetadata=()=>{t.play()}}),this.statusMessage="",this.isVideoReady=!0}catch(t){throw this.statusMessage="无法访问相机，请确保已授权相机权限",t}},async switchCamera(){this.cameraPosition="front"===this.cameraPosition?"back":"front",this.isVideoReady=!1,await this.startCamera()},takePhoto(){var t;if(this.isVideoReady&&this.mediaStream)try{const e=(null==(t=this.$refs.videoElement)?void 0:t.$el)||this.$refs.videoElement,a=this.$refs.canvasElement;if(!e||!a)throw new Error("无法获取视频或画布元素");const s=e.videoWidth||e.offsetWidth,i=e.videoHeight||e.offsetHeight;a.width=s,a.height=i,this.canvasWidth=s,this.canvasHeight=i;a.getContext("2d").drawImage(e,0,0,s,i),this.capturedImage=a.toDataURL("image/jpeg",.9)}catch(e){a({title:"拍照失败，请重试",icon:"none"})}else a({title:"相机未就绪",icon:"none"})},retakePhoto(){this.capturedImage=""},savePhoto(){if(this.capturedImage)try{const t=document.createElement("a");t.download=`photo_${(new Date).getTime()}.jpg`,t.href=this.capturedImage,document.body.appendChild(t),t.click(),document.body.removeChild(t),a({title:"照片已保存",icon:"success"}),this.capturedImage=""}catch(t){a({title:"保存失败",icon:"none"})}},stopCamera(){this.mediaStream&&(this.mediaStream.getTracks().forEach(t=>t.stop()),this.mediaStream=null),this.isVideoReady=!1,this.statusMessage="相机已停止"},onVideoLoaded(){this.isVideoReady=!0,this.statusMessage=""},onVideoError(t){this.statusMessage="视频加载失败",this.isVideoReady=!1}}},[["render",function(t,e,a,v,p,f){const y=l,b=m,C=n,k=u,R=w,_=g;return s(),i(C,{class:"camera-container"},{default:o(()=>[d(" 相机预览区域 "),p.capturedImage?d("v-if",!0):(s(),i(C,{key:0,class:"video-wrapper"},{default:o(()=>[r(y,{class:"video-preview",muted:"",onError:f.onVideoError,controls:!1},null,8,["onError"]),d(" 拍照控制按钮 "),r(C,{class:"camera-controls"},{default:o(()=>[r(C,{class:"control-buttons"},{default:o(()=>[d(' <button\r\n            class="btn btn-secondary"\r\n            @tap="switchCamera"\r\n            :disabled="!isVideoReady"\r\n          >\r\n            {{ cameraPosition === "front" ? "后置" : "前置" }}\r\n          </button>\r\n          <button\r\n            class="btn btn-capture"\r\n            @tap="takePhoto"\r\n            :disabled="!isVideoReady"\r\n          >\r\n            📷 拍照\r\n          </button> '),r(b,{class:"btn btn-secondary",onClick:f.stopCamera},{default:o(()=>[c(h(p.updateText),1)]),_:1},8,["onClick"])]),_:1})]),_:1})]),_:1})),d(" 拍照预览区域 "),p.capturedImage?(s(),i(C,{key:1,class:"photo-preview"},{default:o(()=>[r(k,{src:p.capturedImage,class:"captured-image",mode:"aspectFit"},null,8,["src"]),r(C,{class:"preview-controls"},{default:o(()=>[r(b,{class:"btn btn-secondary",onClick:f.retakePhoto},{default:o(()=>[c("重新拍照")]),_:1},8,["onClick"]),r(b,{class:"btn btn-success",onClick:f.savePhoto},{default:o(()=>[c("保存照片")]),_:1},8,["onClick"])]),_:1})]),_:1})):d("v-if",!0),d(" 状态信息 "),p.statusMessage?(s(),i(C,{key:2,class:"status-info"},{default:o(()=>[r(R,{class:"status-text"},{default:o(()=>[c(h(p.statusMessage),1)]),_:1})]),_:1})):d("v-if",!0),d(" 隐藏的 canvas 用于捕获图像 "),r(_,{ref:"canvasElement",class:"hidden-canvas",width:p.canvasWidth,height:p.canvasHeight},null,8,["width","height"])]),_:1})}],["__scopeId","data-v-236d209b"]]);export{v as default};
