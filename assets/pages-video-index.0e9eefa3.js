import{_ as e,u as t,v as a,s,o as i,e as o,w as d,i as c,j as n,f as r,h,x as l,y as m,t as u,q as f,l as g,z as v}from"./index-4881d226.js";const p=e({data:()=>({videoSrc:"",capturedImage:"",isVideoReady:!1,cameraPosition:"back",statusMessage:"æ­£åœ¨å¯åŠ¨ç›¸æœº...",canvasWidth:640,canvasHeight:480,mediaStream:null,videoContext:null}),mounted(){this.videoContext=t("myVideo"),this.initCamera()},unmounted(){this.stopCamera()},methods:{async initCamera(){try{this.statusMessage="æ­£åœ¨å¯åŠ¨ç›¸æœº...",await this.startCamera()}catch(e){this.statusMessage="ç›¸æœºå¯åŠ¨å¤±è´¥ï¼Œè¯·æ£€æŸ¥æƒé™è®¾ç½®"}},async startCamera(){try{this.mediaStream&&this.mediaStream.getTracks().forEach(e=>e.stop());const e=a(),t={video:{facingMode:"front"===this.cameraPosition?"user":"environment",width:{ideal:e.windowWidth},height:{ideal:.83*e.windowHeight}},audio:!1};this.mediaStream=await navigator.mediaDevices.getUserMedia(t),this.$nextTick(()=>{const e=document.querySelector("video");"srcObject"in e?e.srcObject=this.mediaStream:e.src=window.URL.createObjectURL(this.mediaStream),e.onloadedmetadata=()=>{e.play()}}),this.statusMessage="",this.isVideoReady=!0}catch(e){throw this.statusMessage="æ— æ³•è®¿é—®ç›¸æœºï¼Œè¯·ç¡®ä¿å·²æˆæƒç›¸æœºæƒé™",e}},async switchCamera(){this.cameraPosition="front"===this.cameraPosition?"back":"front",this.isVideoReady=!1,await this.startCamera()},takePhoto(){var e;if(this.isVideoReady&&this.mediaStream)try{const t=(null==(e=this.$refs.videoElement)?void 0:e.$el)||this.$refs.videoElement,a=this.$refs.canvasElement;if(!t||!a)throw new Error("æ— æ³•è·å–è§†é¢‘æˆ–ç”»å¸ƒå…ƒç´ ");const s=t.videoWidth||t.offsetWidth,i=t.videoHeight||t.offsetHeight;a.width=s,a.height=i,this.canvasWidth=s,this.canvasHeight=i;a.getContext("2d").drawImage(t,0,0,s,i),this.capturedImage=a.toDataURL("image/jpeg",.9)}catch(t){s({title:"æ‹ç…§å¤±è´¥ï¼Œè¯·é‡è¯•",icon:"none"})}else s({title:"ç›¸æœºæœªå°±ç»ª",icon:"none"})},retakePhoto(){this.capturedImage=""},savePhoto(){if(this.capturedImage)try{const e=document.createElement("a");e.download=`photo_${(new Date).getTime()}.jpg`,e.href=this.capturedImage,document.body.appendChild(e),e.click(),document.body.removeChild(e),s({title:"ç…§ç‰‡å·²ä¿å­˜",icon:"success"}),this.capturedImage=""}catch(e){s({title:"ä¿å­˜å¤±è´¥",icon:"none"})}},stopCamera(){this.mediaStream&&(this.mediaStream.getTracks().forEach(e=>e.stop()),this.mediaStream=null),this.isVideoReady=!1,this.statusMessage="ç›¸æœºå·²åœæ­¢"},onVideoLoaded(){this.isVideoReady=!0,this.statusMessage=""},onVideoError(e){this.statusMessage="è§†é¢‘åŠ è½½å¤±è´¥",this.isVideoReady=!1}}},[["render",function(e,t,a,s,p,y){const w=m,C=u,k=c,b=f,_=g,V=v;return i(),o(k,{class:"camera-container"},{default:d(()=>[n(" ç›¸æœºé¢„è§ˆåŒºåŸŸ "),p.capturedImage?n("v-if",!0):(i(),o(k,{key:0,class:"video-wrapper"},{default:d(()=>[r(w,{class:"video-preview",muted:"",onError:y.onVideoError,controls:!1},null,8,["onError"]),n(" æ‹ç…§æ§åˆ¶æŒ‰é’® "),r(k,{class:"camera-controls"},{default:d(()=>[r(k,{class:"control-buttons"},{default:d(()=>[r(C,{class:"btn btn-secondary",onClick:y.switchCamera,disabled:!p.isVideoReady},{default:d(()=>[h(l("front"===p.cameraPosition?"åç½®":"å‰ç½®"),1)]),_:1},8,["onClick","disabled"]),r(C,{class:"btn btn-capture",onClick:y.takePhoto,disabled:!p.isVideoReady},{default:d(()=>[h(" ğŸ“· æ‹ç…§ ")]),_:1},8,["onClick","disabled"]),r(C,{class:"btn btn-secondary",onClick:y.stopCamera},{default:d(()=>[h("åœæ­¢")]),_:1},8,["onClick"])]),_:1})]),_:1})]),_:1})),n(" æ‹ç…§é¢„è§ˆåŒºåŸŸ "),p.capturedImage?(i(),o(k,{key:1,class:"photo-preview"},{default:d(()=>[r(b,{src:p.capturedImage,class:"captured-image",mode:"aspectFit"},null,8,["src"]),r(k,{class:"preview-controls"},{default:d(()=>[r(C,{class:"btn btn-secondary",onClick:y.retakePhoto},{default:d(()=>[h("é‡æ–°æ‹ç…§")]),_:1},8,["onClick"]),r(C,{class:"btn btn-success",onClick:y.savePhoto},{default:d(()=>[h("ä¿å­˜ç…§ç‰‡")]),_:1},8,["onClick"])]),_:1})]),_:1})):n("v-if",!0),n(" çŠ¶æ€ä¿¡æ¯ "),p.statusMessage?(i(),o(k,{key:2,class:"status-info"},{default:d(()=>[r(_,{class:"status-text"},{default:d(()=>[h(l(p.statusMessage),1)]),_:1})]),_:1})):n("v-if",!0),n(" éšè—çš„ canvas ç”¨äºæ•è·å›¾åƒ "),r(V,{ref:"canvasElement",class:"hidden-canvas",width:p.canvasWidth,height:p.canvasHeight},null,8,["width","height"])]),_:1})}],["__scopeId","data-v-54f7156e"]]);export{p as default};
