import{_ as e,u as t,s as a,o as s,e as i,w as o,i as d,j as n,f as c,h as r,v as h,x as l,t as m,q as u,l as w,y as g}from"./index-f274b529.js";const f=e({data:()=>({videoSrc:"",capturedImage:"",isVideoReady:!1,cameraPosition:"back",statusMessage:"正在启动相机...",canvasWidth:640,canvasHeight:480,mediaStream:null,videoContext:null}),onReady(){this.videoContext=t("myVideo"),this.initCamera()},unmounted(){this.stopCamera()},methods:{async initCamera(){try{this.statusMessage="正在启动相机...",await this.startCamera()}catch(e){this.statusMessage="相机启动失败，请检查权限设置"}},async startCamera(){try{this.mediaStream&&this.mediaStream.getTracks().forEach(e=>e.stop());const e=window.screen.width||window.innerWidth,t=window.screen.height||window.innerHeight,a=window.devicePixelRatio||1,s=e*a,i=t*a;window.sw=e,window.sh=t,window.dp=a,window.aw=s,window.ah=i;const o={video:{facingMode:"environment",width:{min:640,ideal:Math.max(s,1280),max:1920},height:{min:480,ideal:.83*i,max:1080}},frameRate:{ideal:30,max:60},aspectRatio:{ideal:e/(.83*t)},audio:!1};this.mediaStream=await navigator.mediaDevices.getUserMedia(o),this.$nextTick(()=>{const e=document.querySelector("video");window.vi=e,"srcObject"in e?e.srcObject=this.mediaStream:e.src=window.URL.createObjectURL(this.mediaStream),e.onloadedmetadata=()=>{e.play()}}),this.statusMessage="",this.isVideoReady=!0}catch(e){throw this.statusMessage="无法访问相机，请确保已授权相机权限",e}},async switchCamera(){this.cameraPosition="front"===this.cameraPosition?"back":"front",this.isVideoReady=!1,await this.startCamera()},takePhoto(){var e;if(this.isVideoReady&&this.mediaStream)try{const t=(null==(e=this.$refs.videoElement)?void 0:e.$el)||this.$refs.videoElement,a=this.$refs.canvasElement;if(!t||!a)throw new Error("无法获取视频或画布元素");const s=t.videoWidth||t.offsetWidth,i=t.videoHeight||t.offsetHeight;a.width=s,a.height=i,this.canvasWidth=s,this.canvasHeight=i;a.getContext("2d").drawImage(t,0,0,s,i),this.capturedImage=a.toDataURL("image/jpeg",.9)}catch(t){a({title:"拍照失败，请重试",icon:"none"})}else a({title:"相机未就绪",icon:"none"})},retakePhoto(){this.capturedImage=""},savePhoto(){if(this.capturedImage)try{const e=document.createElement("a");e.download=`photo_${(new Date).getTime()}.jpg`,e.href=this.capturedImage,document.body.appendChild(e),e.click(),document.body.removeChild(e),a({title:"照片已保存",icon:"success"}),this.capturedImage=""}catch(e){a({title:"保存失败",icon:"none"})}},stopCamera(){this.mediaStream&&(this.mediaStream.getTracks().forEach(e=>e.stop()),this.mediaStream=null),this.isVideoReady=!1,this.statusMessage="相机已停止"},onVideoLoaded(){this.isVideoReady=!0,this.statusMessage=""},onVideoError(e){this.statusMessage="视频加载失败",this.isVideoReady=!1}}},[["render",function(e,t,a,f,v,p){const y=l,C=m,b=d,k=u,_=w,R=g;return s(),i(b,{class:"camera-container"},{default:o(()=>[n(" 相机预览区域 "),v.capturedImage?n("v-if",!0):(s(),i(b,{key:0,class:"video-wrapper"},{default:o(()=>[c(y,{class:"video-preview",muted:"",onError:p.onVideoError,controls:!1},null,8,["onError"]),n(" 拍照控制按钮 "),c(b,{class:"camera-controls"},{default:o(()=>[c(b,{class:"control-buttons"},{default:o(()=>[c(C,{class:"btn btn-secondary",onClick:p.switchCamera,disabled:!v.isVideoReady},{default:o(()=>[r(h("front"===v.cameraPosition?"后置":"前置"),1)]),_:1},8,["onClick","disabled"]),c(C,{class:"btn btn-capture",onClick:p.takePhoto,disabled:!v.isVideoReady},{default:o(()=>[r(" 📷 拍照 ")]),_:1},8,["onClick","disabled"]),c(C,{class:"btn btn-secondary",onClick:p.stopCamera},{default:o(()=>[r("停止")]),_:1},8,["onClick"])]),_:1})]),_:1})]),_:1})),n(" 拍照预览区域 "),v.capturedImage?(s(),i(b,{key:1,class:"photo-preview"},{default:o(()=>[c(k,{src:v.capturedImage,class:"captured-image",mode:"aspectFit"},null,8,["src"]),c(b,{class:"preview-controls"},{default:o(()=>[c(C,{class:"btn btn-secondary",onClick:p.retakePhoto},{default:o(()=>[r("重新拍照")]),_:1},8,["onClick"]),c(C,{class:"btn btn-success",onClick:p.savePhoto},{default:o(()=>[r("保存照片")]),_:1},8,["onClick"])]),_:1})]),_:1})):n("v-if",!0),n(" 状态信息 "),v.statusMessage?(s(),i(b,{key:2,class:"status-info"},{default:o(()=>[c(_,{class:"status-text"},{default:o(()=>[r(h(v.statusMessage),1)]),_:1})]),_:1})):n("v-if",!0),n(" 隐藏的 canvas 用于捕获图像 "),c(R,{ref:"canvasElement",class:"hidden-canvas",width:v.canvasWidth,height:v.canvasHeight},null,8,["width","height"])]),_:1})}],["__scopeId","data-v-f8cb7315"]]);export{f as default};
